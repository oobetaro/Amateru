#
#　インストール時と、バースデータの一括インポーの時、
#  DB上にテーブルを作成するためのSQL文。
#  セミコロンで１ステートメントを表す。
#  "#"で始まる行はコメントとして無視する。
#  このSQL文が読み出されたテーブルが作成される。
#
#  既存の表を削除
#
DROP TABLE TREEPATH IF EXISTS;
DROP TABLE HISTORY  IF EXISTS;
DROP TABLE COMPOSIT IF EXISTS;
DROP TABLE OCCASION IF EXISTS;
DROP TABLE PLANETS_LONGITUDE IF EXISTS;
DROP TABLE HOUSE IF EXISTS;
##############
# OCCASION表 #
##############
CREATE TABLE OCCASION(
 ID        INTEGER 
           GENERATED BY DEFAULT AS IDENTITY(START WITH 1,INCREMENT BY 1) 
           NOT NULL PRIMARY KEY,
 CHARTTYPE VARCHAR(8)    DEFAULT '' NOT NULL, 
 NAME      VARCHAR(40)   DEFAULT '' NOT NULL,
 KANA      VARCHAR(40)   DEFAULT '' NOT NULL, 
 GENDER    INTEGER       DEFAULT 0  NOT NULL,
 JOB       VARCHAR(28)   DEFAULT '' NOT NULL,
 MEMO      VARCHAR(60)   DEFAULT '' NOT NULL,
 ERA       VARCHAR(2)    DEFAULT NULL,   /* [AD],BCのﾌﾗｸﾞ ｺﾝﾎﾟｼﾞｯﾄはNULL */
 DATE      DATE,                                 /* 日付ｺﾝﾎﾟｼﾞｯﾄはNULL可 */
 TIME      TIME,                                     /* 時間はNULLを許す */ 
 PLACENAME VARCHAR(28)   DEFAULT '' NOT NULL,        /* 地名はNULLを許す */
 LATITUDE  DOUBLE,                                   /* 緯度はNULLを許す */
 LONGITUDE DOUBLE,                                   /* 経度はNULLを許す */
 TIMEZONE  VARCHAR(20)   DEFAULT '',         /* ﾀｲﾑｿﾞｰﾝ ｺﾝﾎﾟｼﾞｯﾄはNULL可 */
 NOTE      VARCHAR       DEFAULT '' NOT NULL,
 TIMESTAMP TIMESTAMP     DEFAULT NOW NOT NULL, /* 自動的に現在日時をセット */
 JDAY      DOUBLE                                    /* ユリウス日 */
);
##############
# TREEPATH表 #
##############
CREATE TABLE TREEPATH(
 ID        INTEGER,
 PATH      VARCHAR  DEFAULT '' NOT NULL,
 FOREIGN KEY (ID) REFERENCES OCCASION(ID) ON UPDATE CASCADE
);
#############
# HISTORY表 #
#############
CREATE TABLE HISTORY(
 ID        INTEGER      DEFAULT 0  NOT NULL,
 NAME      VARCHAR(40)  DEFAULT '' NOT NULL,
 MEMO      VARCHAR(60)  DEFAULT '' NOT NULL,
 ERA       VARCHAR(2)   DEFAULT 'AD' NOT NULL,        /* [AD],BCのフラグ */
 DATE      DATE         NOT NULL,            /* この日付はNULLを許さない */
 TIME      TIME,
 PLACENAME VARCHAR(28)  DEFAULT '' NOT NULL,
 LATITUDE  DOUBLE,
 LONGITUDE DOUBLE,
 TIMEZONE  VARCHAR(20)  DEFAULT '' NOT NULL,
 JDAY      DOUBLE,                                    /* ユリウス日 */
 FOREIGN   KEY (ID) REFERENCES OCCASION(ID) ON UPDATE CASCADE
);
##############
# COMPOSIT表 #
##############
CREATE TABLE COMPOSIT(
 ID        INTEGER      DEFAULT 0  NOT NULL,
 NAME      VARCHAR(40)  DEFAULT '' NOT NULL,
 MEMO      VARCHAR(60)  DEFAULT '' NOT NULL,
 ERA       VARCHAR(2)   DEFAULT 'AD' NOT NULL,        /* [AD],BCのフラグ */
 DATE      DATE         NOT NULL,            /* この日付はNULLを許さない */
 TIME      TIME,
 PLACENAME VARCHAR(28)  DEFAULT '' NOT NULL,
 LATITUDE  DOUBLE,
 LONGITUDE DOUBLE,
 TIMEZONE  VARCHAR(20)  DEFAULT '' NOT NULL,
 JDAY      DOUBLE,                                    /* ユリウス日 */
 FOREIGN   KEY (ID) REFERENCES OCCASION(ID) ON UPDATE CASCADE
);
#
CREATE TABLE PLANETS_LONGITUDE(
  JDAY              DOUBLE NOT NULL PRIMARY KEY, /* ユリウス日 */
  SUN               FLOAT, /* 24個の感受点が続く*/
  MOON              FLOAT,
  MERCURY           FLOAT,
  VENUS             FLOAT,
  MARS              FLOAT,
  JUPITER           FLOAT,
  SATURN            FLOAT,
  URANUS            FLOAT,
  NEPTUNE           FLOAT,
  PLUTO             FLOAT,
  NODE              FLOAT,
  TRUE_NODE         FLOAT,
  APOGEE            FLOAT,
  OSCU_APOGEE       FLOAT,
  CHIRON            FLOAT,
  PHOLUS            FLOAT,
  CERES             FLOAT,
  PALLAS            FLOAT,
  JUNO              FLOAT,
  VESTA             FLOAT,
  SOUTH_NODE        FLOAT,
  TRUE_SOUTH_NODE   FLOAT,
  ANTI_APOGEE       FLOAT,
  ANTI_OSCU_APOGEE  FLOAT
);
#
CREATE TABLE HOUSE(
  ID          INTEGER NOT NULL PRIMARY KEY,     /* 個人データのID */
  AC          FLOAT, /* アセンダント */
  DC          FLOAT, /* ディセンダント */
  MC          FLOAT,
  IC          FLOAT,
  VERTEX      FLOAT,
  ANTI_VERTEX FLOAT,
  CUSP1       FLOAT, /* C1〜C12までハウスカスプ */
  CUSP2       FLOAT,
  CUSP3       FLOAT,
  CUSP4       FLOAT,
  CUSP5       FLOAT,
  CUSP6       FLOAT,
  CUSP7       FLOAT,
  CUSP8       FLOAT,
  CUSP9       FLOAT,
  CUSP10      FLOAT,
  CUSP11      FLOAT,
  CUSP12      FLOAT
);
#
# テーブルの新規作成時にguestアカウントに読み取り権限を与える。
# (テーブルを削除して再作成したときも権限を再発行する必要がある)
#
GRANT SELECT ON TREEPATH TO "guest";
GRANT SELECT ON OCCASION TO "guest";
GRANT SELECT ON TREEPATH TO "guest";
GRANT SELECT ON PLANETS_LONGITUDE TO "guest";
GRANT SELECT ON HOUSE TO "guest";
GRANT SELECT ON HISTORY TO "guest";
